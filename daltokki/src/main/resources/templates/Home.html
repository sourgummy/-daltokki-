<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë‹¬í† ë¼</title>
    <!-- kakao -->
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/modalStyle.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Bootstrap JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<script>
    // ë§í¬ ê³µìœ  ëª¨ë‹¬ ì—´ê¸°
    function openCopyModal() {
        $("#ShareModal").modal("show");
    }

    // css í…ŒìŠ¤íŠ¸ìš© ëª¨ë‹¬ ì—´ê¸°
    function openTestModal() {
        $("#exampleModalCenter").modal("show");
    }

    // ë³µì‚¬ ê¸°ëŠ¥
    function CopyLink() {
        const url = document.getElementById("CopyUrl");

        navigator.clipboard.writeText(url.value); // ì£¼ì†Œ ë³µì‚¬
        $("#ShareModal").modal("hide"); // ëª¨ë‹¬ ì°½ ë‹«ê¸°
    }

    // ì¹´ì¹´ì˜¤ Custom -> ì–˜ëŠ” ëª¨ë‹¬ë¡œ ì•ˆëœë‹¤ê³  í•©ë‹ˆë‹¤.
    try {
      function sendLinkDefault() {
        Kakao.init('efbfe79e4b4775d2088ca0e7d9a8edf1')
        Kakao.Link.sendDefault({
          objectType: 'feed',
          content: {
            title: 'ë‹¬í† ë¼ğŸ°',
            description: 'êµ¶ê³ ìˆëŠ” ì €ì—ê²Œ ìµœê³ ì˜ ì†¡í¸ì„ ë§Œë“¤ì–´ ì£¼ìƒˆìš”ğŸ˜¢ğŸ˜¢',
            imageUrl:
              'http://k.kakaocdn.net/dn/bozSxc/btsp6qTBbFg/rQywrAKm7RY1uAcBbmdqrk/kakaolink40_original.png',
            link: {
              mobileWebUrl: 'https://developers.kakao.com',
              webUrl: 'https://developers.kakao.com',
            },
          },
          buttons: [
            {
              title: 'ì›¹ìœ¼ë¡œ ë³´ê¸°',
              link: {
                mobileWebUrl: 'https://developers.kakao.com',
                webUrl: 'https://developers.kakao.com',
              },
            },
          ],
        })
      }
    ; window.kakaoDemoCallback && window.kakaoDemoCallback() }
    catch(e) { window.kakaoDemoException && window.kakaoDemoException(e) }

    // ëª¨ë‹¬ ë²„íŠ¼ - ì†¡í¸ ì§€ìš°ê¸°
    function DeleteSp() {
<!--         const spId = document.getElementById('#modalSpId').innerText;-->
         const spId = $('#modalSpId').text(); // ìˆ˜ì •ëœ ë¶€ë¶„

         $.ajax({
                type: 'Post',
                url: 'main/deleteSp',
                data: { spId: spId },
                success: function(data) {
                    alert("ì†¡í¸ì´ ì‚­ì œë˜ì—ˆìŠ´ë‹ˆë‹¹!");
                    $('.row').load(location.href+' .row');
                }
         });
    }

   // ì†¡í¸ ë‚´ìš© ì¡°íšŒ ëª¨ë‹¬
   $(document).ready(function() {
        $('#ContentModal').on('show.bs.modal', function(event) {
            const spId = $(event.relatedTarget).data('spid');
            console.log(spId);

            // ì†¡í¸ ë‚´ìš© ajaxë¡œ ì¡°íšŒ
            $.ajax({
                type: 'GET',
                url: 'main/findSp',
                data: { spId: spId },
                success: function(data) {
                    // ëª¨ë‹¬ ë‚´ìš© ì—…ë°ì´íŠ¸
                    console.log(data);
                    $('#modalLabel').text('ì†¡í¸');
                    $('#modalSpId').text(data.spId);
                    $('#modalSpName').text(data.name);
                    $('#modalSpContent').text(data.content);
                },
                error: function(xhr, status, error) {
                    console.error('AJAX Error:', error);
                }
            });
        });
    });
</script>
<body>
    <div class="container">
        <div class="box">
            <div class="row">
                <div th:each="sp : ${spList}" class="col-md-4">
                    <div>
                        <a href="#" data-toggle="modal" data-target="#ContentModal" th:data-spId="${sp.spId}">
                            <img src="http://k.kakaocdn.net/dn/bozSxc/btsp6qTBbFg/rQywrAKm7RY1uAcBbmdqrk/kakaolink40_original.png" width="100px" height="100px">
                        </a>
                        <a href="#" data-toggle="modal" data-target="#ContentModal" th:text="${sp.name}" th:data-spId="${sp.spId}"></a>
                    </div>
                </div>
            </div>

            <div class="btn">
                <button id="main" onclick="location.href='/'">ë©”ì¸(ì„ì‹œ)</button>
<!--                <button id="write" onclick="location.href='write'">ì†¡í¸ ë§Œë“¤ê¸°</button>-->
                <button id="shareKakao" onClick="sendLinkDefault()">ì¹´ì¹´ì˜¤ ê³µìœ </button>
                <button id="shareLink" onclick="openCopyModal()">ë§í¬ ê³µìœ </button>
                <button id="googleLogin" onclick="location.href='/login/oauth2/code/{ì—¬ê¸°ì•„ì´ë””ë¥¼ ì–´ì¼€ë„£ìŒ}'">êµ¬ê¸€ ë¡œê·¸ì¸</button>
                <!------------------miju---------------------------->
                <!--ë©”ì‹œì§€ ì‘ì„± í˜ì´ì§€ë¡œ ì´ë™-->
                <button onclick="location.href='writeMessage'">ë©”ì‹œì§€ ì‘ì„±</button>
                <!------------------miju---------------------------->
            </div>
        </div>

        <!--ëª¨ë‹¬ ì˜ì—­ -->
        <!-- ë§í¬ê³µìœ  ëª¨ë‹¬ -->
        <div id="ShareModal" class="modal fade" role="dialog">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
<!--                <div class="modal-content" style="width: 60%">-->
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">ë§í¬ ê³µìœ </h4>
                    </div>
                    <div class="modal-body">
                        <!-- ê³µìœ í•  URL ì…ë ¥ í¼ -->
<!--                        <span><img th:src="@{/getQrcode}" alt="QR Code" style="width: 70%; text-align: center;"/></span>-->
<!--                        <span><input type="text" id="CopyUrl" th:value="${#httpServletRequest.getRequestURL()}" style="width: 100%"></span>-->
<!--                        <span><img th:src="@{/getQrcode}" alt="QR Code"/></span>-->
<!--                        <span><input type="text" id="CopyUrl" th:value="${#httpServletRequest.getRequestURL()}"></span>-->

                        <div class="p-4 to-front">
                            <div class="text-center">
                                <div class="qr">
                                    <img th:src="@{main/getQrcode}" alt="QR Code" class="img-fluid mb-4"/>
                                </div>
<!--                                <h3>í…ŒìŠ¤íŠ¸ìš© ëª¨ë‹¬</h3>-->
                                <br><p class="mb-4">ì¹œêµ¬ì—ê²Œ ë‹¬í† ë¼ë¥¼ ê³µìœ í•˜ì„¸ìš©!ğŸ°</p>
                                <form action="#" class="mb-4">
                                    <div class="form-group">
                                        <input type="text" id="CopyUrl" class="form-control w-100 mr-3" th:value="${#httpServletRequest.getRequestURL()}">
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <button class="btn btn-secondary btn-block" onclick="CopyLink()">ë³µì‚¬í•˜ê¸°</button>
                                        </div>
                                        <div class="col-6">
                                            <button class="btn btn-primary btn-block" data-dismiss="modal">ë‹«ê¸°</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
<!--                        <button type="button" class="btn btn-primary" onclick="CopyLink()">ë³µì‚¬í•˜ê¸°</button>-->
<!--                        <button type="button" class="btn btn-default" data-dismiss="modal">ë‹«ê¸°</button>-->
<!--                        <button type="button" class="btn btn-primary" onclick="CopyLink()" style="width: 40%">ë³µì‚¬í•˜ê¸°</button>-->
<!--                        <button type="button" class="btn btn-default" data-dismiss="modal" style="width: 40%">ë‹«ê¸°</button>-->
                    </div>
                </div>
            </div>
        </div>

        <!-- ì†¡í¸ ë‚´ìš© ì¡°íšŒ ëª¨ë‹¬ -->
        <div id="ContentModal" class="modal modal-bottom fade" role="dialog">
<!--                <div class="modal-dialog modal-fullsize">-->
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
<!--                        <div class="modal-content modal-fullsize">-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">ì†¡í¸</h4>
                        <button type="button" class="btn btn-default" data-dismiss="modal" onclick="DeleteSp()">ì§€ìš°ê¸°</button>
                    </div>
                    <div class="modal-body">
                        <div>
                            <span>ID: </span><span id="modalSpId"></span>
                        </div>
                        <div>
                            <span>Name: </span><span id="modalSpName"></span>
                        </div>
                        <div>
                            <span>Content: </span><span id="modalSpContent"></span>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">ë‹«ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>